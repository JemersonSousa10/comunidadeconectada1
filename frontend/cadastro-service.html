<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Servi√ßo - Comunidade Conectada</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/accessibility.css">
</head>
<body>
    <header role="banner">
        <nav class="navbar" role="navigation" aria-label="Navega√ß√£o principal">
            <div class="nav-container">
                <h1 class="logo">
                    <a href="index.html" aria-label="Comunidade Conectada">
                        üåê Comunidade Conectada
                    </a>
                </h1>
                <ul class="nav-menu">
                    <li><a href="index.html">In√≠cio</a></li>
                    <li><a href="services.html">Servi√ßos</a></li>
                    <li><a href="dashboard.html">Meu Painel</a></li>
                    <li><a href="#" id="logoutBtn">Sair</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main role="main">
        <section class="auth-section" aria-labelledby="cadastro-servico-title">
            <div class="auth-container">
                <div class="auth-card">
                    <h1 id="cadastro-servico-title">Cadastrar Novo Servi√ßo</h1>
                    <p class="auth-subtitle">Ofere√ßa seus servi√ßos para a comunidade</p>

                    <form id="servicoForm" class="auth-form">
                        <div class="form-group">
                            <label for="nome_servico">Nome do Servi√ßo *</label>
                            <input 
                                type="text" 
                                id="nome_servico" 
                                name="nome_servico" 
                                required 
                                aria-required="true"
                                placeholder="Ex: Encanador residencial, Aulas de matem√°tica..."
                            >
                        </div>

                        <div class="form-group">
                            <label for="categoria">Categoria *</label>
                            <select id="categoria" name="categoria" required aria-required="true">
                                <option value="">Selecione uma categoria</option>
                                <option value="reparos">Reparos Dom√©sticos</option>
                                <option value="limpeza">Limpeza</option>
                                <option value="aulas">Aulas Particulares</option>
                                <option value="cuidados">Cuidados Pessoais</option>
                                <option value="tecnologia">Tecnologia</option>
                                <option value="eventos">Eventos</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="descricao">Descri√ß√£o do Servi√ßo *</label>
                            <textarea 
                                id="descricao" 
                                name="descricao" 
                                rows="4" 
                                required 
                                aria-required="true"
                                placeholder="Descreva detalhadamente o servi√ßo que voc√™ oferece..."
                            ></textarea>
                        </div>

                        <div class="form-group">
                            <label for="valor">Valor (R$) *</label>
                            <input 
                                type="number" 
                                id="valor" 
                                name="valor" 
                                step="0.01" 
                                min="0" 
                                required 
                                aria-required="true"
                                placeholder="0,00"
                            >
                        </div>

                        <div class="form-group">
                            <label for="contato">Contato *</label>
                            <input 
                                type="text" 
                                id="contato" 
                                name="contato" 
                                required 
                                aria-required="true"
                                placeholder="Telefone, WhatsApp, e-mail..."
                            >
                        </div>

                        <div class="form-group">
                            <label for="localizacao">Localiza√ß√£o</label>
                            <input 
                                type="text" 
                                id="localizacao" 
                                name="localizacao" 
                                placeholder="Bairro, regi√£o ou cidade onde atende"
                            >
                        </div>

                        <button type="submit" class="btn btn-primary btn-full" id="submitBtn">
                            Cadastrar Servi√ßo
                        </button>

                        <div class="auth-links">
                            <a href="dashboard.html">‚Üê Voltar para o painel</a>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <footer role="contentinfo">
        <div class="container">
            <p>&copy; 2025 Comunidade Conectada. Projeto Integrador II - UNIVESP.</p>
        </div>
    </footer>

    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    
    <script>
        // Configura√ß√£o da API - ATUALIZE COM SUA URL
        const API_BASE = 'https://comunidade-conectada-backend.onrender.com/';
        
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar autentica√ß√£o e se √© prestador
            if (!auth.isLoggedIn()) {
                alert('‚ö†Ô∏è Voc√™ precisa estar logado para acessar esta p√°gina');
                window.location.href = 'login.html';
                return;
            }
            
            const user = auth.getCurrentUser();
            if (user.tipo !== 'prestador') {
                alert('‚ùå Apenas prestadores de servi√ßos podem cadastrar servi√ßos');
                window.location.href = 'dashboard.html';
                return;
            }

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                auth.handleLogout();
            });

            // Form submission
            document.getElementById('servicoForm').addEventListener('submit', handleServiceCreate);
        });

     async function handleServiceCreate(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('submitBtn');
    const originalText = submitBtn.textContent;
    
    try {
        submitBtn.textContent = 'Cadastrando...';
        submitBtn.disabled = true;
        
        const formData = {
            nome_servico: document.getElementById('nome_servico').value,
            categoria: document.getElementById('categoria').value,
            descricao: document.getElementById('descricao').value,
            valor: parseFloat(document.getElementById('valor').value),
            contato: document.getElementById('contato').value,
            localizacao: document.getElementById('localizacao').value
        };
        
        // Valida√ß√µes b√°sicas
        if (formData.valor < 0) {
            throw new Error('O valor deve ser positivo');
        }
        
        // Use a API do seu api.js
        const result = await api.post('/services', formData);
        
        alert('‚úÖ Servi√ßo cadastrado com sucesso!');
        window.location.href = 'dashboard.html';
        
    } catch (error) {
        console.error('Erro:', error);
        alert(`‚ùå Erro: ${error.message}`);
    } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
    }
}
    </script>

    <script>
        // Adicionar logout dinamicamente
        document.addEventListener('DOMContentLoaded', function() {
            // Pequeno delay para garantir que o auth.js carregou
            setTimeout(() => {
                if (typeof addLogoutButton === 'function') {
                    addLogoutButton();
                }
            }, 100);
        });
    </script>
</body>
</html>